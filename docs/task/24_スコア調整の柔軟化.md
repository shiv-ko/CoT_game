# ã‚¿ã‚¹ã‚¯#24: ã‚¹ã‚³ã‚¢èª¿æ•´ã®æŸ”è»ŸåŒ–

## æ¦‚è¦

ç¾åœ¨ã®ã‚¹ã‚³ã‚¢ç®—å‡ºã‚·ã‚¹ãƒ†ãƒ ã¯ã€å…¨ã¦ã®å•é¡Œã«å¯¾ã—ã¦å›ºå®šã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼ˆ`r0=0.05`, `p=2.0`ï¼‰ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ã€‚
ã—ã‹ã—ã€å•é¡Œã®æ€§è³ªã«ã‚ˆã£ã¦é©åˆ‡ãªã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¯ç•°ãªã‚‹ãŸã‚ã€å•é¡Œã”ã¨ã«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’èª¿æ•´ã§ãã‚‹æŸ”è»Ÿãªä»•çµ„ã¿ãŒå¿…è¦ã€‚

## èƒŒæ™¯

### ç¾åœ¨ã®ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°æ–¹å¼ï¼ˆv2ï¼‰

ç›¸å¯¾èª¤å·®ãƒ™ãƒ¼ã‚¹ã®ãƒ­ã‚¸ã‚¹ãƒ†ã‚£ãƒƒã‚¯é–¢æ•°ã‚’ä½¿ç”¨:

```
ç›¸å¯¾èª¤å·® rel = |y_pred - y_true| / max(|y_true|, tolAbsHint)
ã‚¹ã‚³ã‚¢ = 100 / (1 + (rel / r0)^p)
```

**ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿:**

- `r0`: ã‚¹ã‚³ã‚¢ãŒ50ç‚¹ã«ãªã‚‹ç›¸å¯¾èª¤å·®ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 0.05 = 5%ï¼‰
- `p`: æ›²ç‡ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 2.0ï¼‰

### å•é¡Œã®å¤šæ§˜æ€§

| å•é¡Œã‚¿ã‚¤ãƒ—     | ç‰¹æ€§                 | é©åˆ‡ãªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿              |
| -------------- | -------------------- | ----------------------------- |
| ç®—æ•°ãƒ»åŸºç¤è¨ˆç®— | é«˜ç²¾åº¦ãŒæ±‚ã‚ã‚‰ã‚Œã‚‹   | `r0=0.01, p=3.0` (å³ã—ã‚)     |
| ç‰©ç†è¨ˆç®—ãƒ»æ¦‚ç®— | æœ‰åŠ¹æ¡æ•°3-4æ¡ç¨‹åº¦    | `r0=0.05, p=2.0` (ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ) |
| çµ±è¨ˆãƒ»æ¨å®š     | èª¤å·®ãŒå¤§ããã¦ã‚‚è¨±å®¹ | `r0=0.10, p=1.5` (ç·©ã‚)       |
| è«–ç†ãƒ‘ã‚ºãƒ«     | å®Œå…¨ä¸€è‡´ã®ã¿         | å¾“æ¥ã®æ–‡å­—åˆ—æ¯”è¼ƒ              |

## ç›®æ¨™

1. **å•é¡Œã”ã¨ã«ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’è¨­å®šå¯èƒ½ã«ã™ã‚‹**
2. **æ—¢å­˜ã®å•é¡Œã«ã¯å½±éŸ¿ã‚’ä¸ãˆãªã„ï¼ˆå¾Œæ–¹äº’æ›æ€§ï¼‰**
3. **ç®¡ç†ç”»é¢ã‹ã‚‰ç°¡å˜ã«è¨­å®šã§ãã‚‹UIï¼ˆå°†æ¥å®Ÿè£…ï¼‰**

---

## å®Ÿè£…ãƒ—ãƒ©ãƒ³

### Phase 1: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒæ‹¡å¼µ ğŸ—ï¸

#### 1.1 ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ

**ãƒ•ã‚¡ã‚¤ãƒ«:** `db/migrations/20250128_add_scoring_params.sql`

```sql
-- ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’questionsãƒ†ãƒ¼ãƒ–ãƒ«ã«è¿½åŠ 
ALTER TABLE questions
ADD COLUMN scoring_r0 DOUBLE PRECISION DEFAULT 0.05,
ADD COLUMN scoring_p DOUBLE PRECISION DEFAULT 2.0,
ADD COLUMN scoring_tol_abs_hint DOUBLE PRECISION DEFAULT 0.01;

-- ã‚³ãƒ¡ãƒ³ãƒˆè¿½åŠ ï¼ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰
COMMENT ON COLUMN questions.scoring_r0 IS
  'ã‚¹ã‚³ã‚¢ãŒ50ç‚¹ã«ãªã‚‹ç›¸å¯¾èª¤å·®ã®åŸºæº–å€¤ï¼ˆ0.05 = 5%ï¼‰';

COMMENT ON COLUMN questions.scoring_p IS
  'ãƒ­ã‚¸ã‚¹ãƒ†ã‚£ãƒƒã‚¯é–¢æ•°ã®æ›²ç‡ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼ˆå¤§ãã„ã»ã©å³ã—ã„ï¼‰';

COMMENT ON COLUMN questions.scoring_tol_abs_hint IS
  'æ­£è§£ãŒ0ã«è¿‘ã„å ´åˆã®ã‚¹ã‚±ãƒ¼ãƒ«è£œåŠ©å€¤';

-- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ï¼ˆæ¤œç´¢ã‚¯ã‚¨ãƒªã®æœ€é©åŒ–ã¯ä¸è¦ã ãŒã€å°†æ¥çš„ãªçµ±è¨ˆåˆ†æç”¨ï¼‰
CREATE INDEX idx_questions_scoring_params ON questions(scoring_r0, scoring_p);
```

#### 1.2 init.sqlæ›´æ–°

æ–°è¦ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ§‹ç¯‰æ™‚ã«å¯¾å¿œ:

```sql
CREATE TABLE questions (
    id SERIAL PRIMARY KEY,
    level INT NOT NULL,
    problem_statement TEXT NOT NULL,
    correct_answer VARCHAR(255) NOT NULL,
    scoring_r0 DOUBLE PRECISION DEFAULT 0.05,
    scoring_p DOUBLE PRECISION DEFAULT 2.0,
    scoring_tol_abs_hint DOUBLE PRECISION DEFAULT 0.01,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
);
```

---

### Phase 2: ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒ¢ãƒ‡ãƒ«æ›´æ–° ğŸ”§

#### 2.1 Questionæ§‹é€ ä½“ã®æ‹¡å¼µ

**ãƒ•ã‚¡ã‚¤ãƒ«:** `backend/models/question.go`

```go
// Question ã¯å†…éƒ¨å‡¦ç†ç”¨ã®å®Œå…¨ãªå•é¡Œæƒ…å ±ã‚’è¡¨ã™æ§‹é€ ä½“ã§ã™ã€‚
type Question struct {
    ID               int       `json:"id"`
    Level            int       `json:"level"`
    ProblemStatement string    `json:"problem_statement"`
    CorrectAnswer    string    `json:"correct_answer"`

    // ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼ˆv2.1ã§è¿½åŠ ï¼‰
    ScoringR0        float64   `json:"scoring_r0" db:"scoring_r0"`           // r0ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
    ScoringP         float64   `json:"scoring_p" db:"scoring_p"`             // pãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
    ScoringTolAbsHint float64  `json:"scoring_tol_abs_hint" db:"scoring_tol_abs_hint"` // tolAbsHint

    CreatedAt        time.Time `json:"created_at"`
}

// DefaultScoringParams ã¯æ–°è¦å•é¡Œä½œæˆæ™‚ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’è¿”ã—ã¾ã™
func DefaultScoringParams() (r0, p, tolAbsHint float64) {
    return 0.05, 2.0, 0.01
}
```

**å¾Œæ–¹äº’æ›æ€§ã®ç¢ºä¿:**

- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®DEFAULTå€¤ã«ã‚ˆã‚Šã€æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã¯è‡ªå‹•çš„ã«ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’æŒã¤
- NULLãƒã‚§ãƒƒã‚¯ã¯ä¸è¦ï¼ˆNOT NULLåˆ¶ç´„ã‚’è¿½åŠ ã—ãªã„å ´åˆã¯å¿…è¦ï¼‰

---

### Phase 3: Evaluatorã®æ‹¡å¼µ ğŸ§®

#### 3.1 EvaluateWithParamsé–¢æ•°ã®è¿½åŠ 

**ãƒ•ã‚¡ã‚¤ãƒ«:** `backend/internal/eval/evaluator.go`

```go
// ScoringParams ã¯ã‚¹ã‚³ã‚¢ç®—å‡ºã«ä½¿ç”¨ã™ã‚‹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ã¾ã¨ã‚ãŸæ§‹é€ ä½“
type ScoringParams struct {
    R0         float64 // ã‚¹ã‚³ã‚¢ãŒ50ç‚¹ã«ãªã‚‹ç›¸å¯¾èª¤å·®
    P          float64 // æ›²ç‡ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
    TolAbsHint float64 // æ­£è§£ãŒ0ã®å ´åˆã®ã‚¹ã‚±ãƒ¼ãƒ«è£œåŠ©
}

// DefaultScoringParams ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’è¿”ã—ã¾ã™
func DefaultScoringParams() ScoringParams {
    return ScoringParams{
        R0:         0.05,
        P:          2.0,
        TolAbsHint: 0.01,
    }
}

// EvaluateWithParams ã¯ã‚«ã‚¹ã‚¿ãƒ ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ä½¿ç”¨ã—ã¦ã‚¹ã‚³ã‚¢ã‚’ç®—å‡ºã—ã¾ã™
func EvaluateWithParams(answerText string, correct string, params ScoringParams) (score int, extracted *float64, mode string, detail map[string]any) {
    // æ—¢å­˜ã®Evaluateé–¢æ•°ã®ãƒ­ã‚¸ãƒƒã‚¯ã‚’ã“ã“ã«ç§»æ¤
    // ãŸã ã—ã€å®šæ•°ã§ã¯ãªãparams.R0, params.P, params.TolAbsHintã‚’ä½¿ç”¨

    // ... (å®Ÿè£…ã¯æ—¢å­˜ã®Evaluateã¨åŒæ§˜)

    // detailã«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æƒ…å ±ã‚’è¿½åŠ 
    detail["score_params"] = map[string]float64{
        "r0":           params.R0,
        "p":            params.P,
        "tol_abs_hint": params.TolAbsHint,
    }

    return
}

// Evaluate ã¯å¾Œæ–¹äº’æ›æ€§ã®ãŸã‚ã«ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§è©•ä¾¡ã—ã¾ã™
func Evaluate(answerText string, correct string) (score int, extracted *float64, mode string, detail map[string]any) {
    return EvaluateWithParams(answerText, correct, DefaultScoringParams())
}
```

#### 3.2 computeScoreã®æ›´æ–°

```go
// computeScoreWithParams ã¯ã‚«ã‚¹ã‚¿ãƒ ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ä½¿ç”¨ã—ã¦ã‚¹ã‚³ã‚¢ã‚’è¨ˆç®—ã—ã¾ã™
func computeScoreWithParams(relativeError float64, params ScoringParams) int {
    if relativeError <= 0 {
        return 100
    }

    ratio := relativeError / params.R0
    raw := 100.0 / (1.0 + math.Pow(ratio, params.P))

    if raw < 0 {
        raw = 0
    }
    if raw > 100 {
        raw = 100
    }

    return int(math.Round(raw))
}
```

---

### Phase 4: ãƒãƒ³ãƒ‰ãƒ©ãƒ¼å±¤ã®æ›´æ–° ğŸ¯

#### 4.1 SolveHandlerã®ä¿®æ­£

**ãƒ•ã‚¡ã‚¤ãƒ«:** `backend/handlers/solve_handler.go`

```go
// PostSolve å†…ã§å•é¡Œã®ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¦ä½¿ç”¨

func (h *SolveHandler) PostSolve(c *gin.Context) {
    // ... (æ—¢å­˜ã®å‡¦ç†)

    // å•é¡Œæƒ…å ±ã®å–å¾—ï¼ˆã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å«ã‚€ï¼‰
    question, err := h.getQuestionWithScoringParams(ctx, req.QuestionID)
    if err != nil {
        log.Printf("å•é¡Œæƒ…å ±ã®å–å¾—ã«å¤±æ•—: %v", err)
        c.JSON(http.StatusInternalServerError, gin.H{"error": "å•é¡Œæƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ"})
        return
    }

    // æ­£è§£ã®å–å¾—
    correctAnswer := question.CorrectAnswer

    // ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®æ§‹ç¯‰
    scoringParams := eval.ScoringParams{
        R0:         question.ScoringR0,
        P:          question.ScoringP,
        TolAbsHint: question.ScoringTolAbsHint,
    }

    // ã‚«ã‚¹ã‚¿ãƒ ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ä½¿ç”¨ã—ã¦è©•ä¾¡
    score, extractedNumber, evalMode, evalDetail := eval.EvaluateWithParams(
        aiOutput,
        correctAnswer,
        scoringParams,
    )

    // ... (ä»¥é™ã®å‡¦ç†ã¯åŒã˜)
}

// getQuestionWithScoringParams ã¯å•é¡Œæƒ…å ±ã‚’ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ä»˜ãã§å–å¾—ã—ã¾ã™
func (h *SolveHandler) getQuestionWithScoringParams(ctx context.Context, questionID int) (*models.Question, error) {
    query := `
        SELECT id, level, problem_statement, correct_answer,
               scoring_r0, scoring_p, scoring_tol_abs_hint, created_at
        FROM questions
        WHERE id = $1
    `

    var q models.Question
    err := h.DB.QueryRowContext(ctx, query, questionID).Scan(
        &q.ID,
        &q.Level,
        &q.ProblemStatement,
        &q.CorrectAnswer,
        &q.ScoringR0,
        &q.ScoringP,
        &q.ScoringTolAbsHint,
        &q.CreatedAt,
    )

    if err != nil {
        return nil, err
    }

    return &q, nil
}
```

---

### Phase 5: ãƒ†ã‚¹ãƒˆã®æ›´æ–° âœ…

#### 5.1 evaluator_test.goã®æ›´æ–°

```go
func TestEvaluateWithCustomParams(t *testing.T) {
    tests := []struct {
        name           string
        answer         string
        correct        string
        params         eval.ScoringParams
        expectedScore  int
        expectedMode   string
    }{
        {
            name:    "å³ã—ã„ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿: r0=0.01, p=3.0",
            answer:  "10.05",
            correct: "10",
            params: eval.ScoringParams{
                R0:         0.01,
                P:          3.0,
                TolAbsHint: 0.01,
            },
            expectedScore: 11, // ç›¸å¯¾èª¤å·®0.5%ã§ã‚‚å³ã—ãæ¸›ç‚¹
            expectedMode:  "numeric_score",
        },
        {
            name:    "ç·©ã„ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿: r0=0.10, p=1.5",
            answer:  "10.5",
            correct: "10",
            params: eval.ScoringParams{
                R0:         0.10,
                P:          1.5,
                TolAbsHint: 0.01,
            },
            expectedScore: 69, // ç›¸å¯¾èª¤å·®5%ã§ã‚‚æ¯”è¼ƒçš„é«˜å¾—ç‚¹
            expectedMode:  "numeric_score",
        },
    }

    for _, tt := range tests {
        t.Run(tt.name, func(t *testing.T) {
            score, _, mode, _ := eval.EvaluateWithParams(tt.answer, tt.correct, tt.params)

            if score != tt.expectedScore {
                t.Errorf("æœŸå¾…: %d, å®Ÿéš›: %d", tt.expectedScore, score)
            }
            if mode != tt.expectedMode {
                t.Errorf("æœŸå¾…: %s, å®Ÿéš›: %s", tt.expectedMode, mode)
            }
        })
    }
}
```

---

### Phase 6: å•é¡Œç®¡ç†APIï¼ˆå°†æ¥å®Ÿè£…ï¼‰ ğŸš€

#### 6.1 å•é¡Œä½œæˆãƒ»æ›´æ–°API

**ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ:** `POST /api/v1/admin/questions`

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£:**

```json
{
  "level": 2,
  "problem_statement": "å††å‘¨ç‡Ï€ã®å€¤ã‚’å°æ•°ç‚¹ä»¥ä¸‹3æ¡ã¾ã§æ±‚ã‚ã‚ˆ",
  "correct_answer": "3.142",
  "scoring_params": {
    "r0": 0.001,
    "p": 2.5,
    "tol_abs_hint": 0.001
  }
}
```

**çœç•¥æ™‚ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå‹•ä½œ:**

```json
{
  "level": 1,
  "problem_statement": "1+1ã¯ï¼Ÿ",
  "correct_answer": "2"
  // scoring_paramsã‚’çœç•¥ â†’ ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ãŒä½¿ç”¨ã•ã‚Œã‚‹
}
```

#### 6.2 ãƒ—ãƒªã‚»ãƒƒãƒˆç®¡ç†

**ãƒ•ã‚¡ã‚¤ãƒ«:** `backend/internal/eval/presets.go`

```go
// ScoringPreset ã¯äº‹å‰å®šç¾©ã•ã‚ŒãŸã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°è¨­å®š
type ScoringPreset string

const (
    PresetDefault   ScoringPreset = "default"    // r0=0.05, p=2.0
    PresetStrict    ScoringPreset = "strict"     // r0=0.01, p=3.0
    PresetLenient   ScoringPreset = "lenient"    // r0=0.10, p=1.5
    PresetVeryStrict ScoringPreset = "very_strict" // r0=0.005, p=4.0
)

// GetPreset ã¯ãƒ—ãƒªã‚»ãƒƒãƒˆåã‹ã‚‰å¯¾å¿œã™ã‚‹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¾ã™
func GetPreset(preset ScoringPreset) ScoringParams {
    switch preset {
    case PresetStrict:
        return ScoringParams{R0: 0.01, P: 3.0, TolAbsHint: 0.01}
    case PresetLenient:
        return ScoringParams{R0: 0.10, P: 1.5, TolAbsHint: 0.01}
    case PresetVeryStrict:
        return ScoringParams{R0: 0.005, P: 4.0, TolAbsHint: 0.001}
    default:
        return DefaultScoringParams()
    }
}
```

---

### Phase 7: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼ˆç®¡ç†ç”»é¢ï¼‰ ğŸ¨

#### 7.1 å•é¡Œä½œæˆãƒ•ã‚©ãƒ¼ãƒ ï¼ˆå°†æ¥å®Ÿè£…ï¼‰

```typescript
interface QuestionFormData {
  level: number;
  problemStatement: string;
  correctAnswer: string;
  scoringPreset?: 'default' | 'strict' | 'lenient' | 'very_strict' | 'custom';
  customScoringParams?: {
    r0: number;
    p: number;
    tolAbsHint: number;
  };
}
```

#### 7.2 ã‚¹ã‚³ã‚¢ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼

å•é¡Œä½œæˆæ™‚ã«ã€å„ç¨®èª¤å·®ã§ã®ã‚¹ã‚³ã‚¢ã‚’ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼:

```
èª¤å·® 0.1%  â†’ 99ç‚¹
èª¤å·® 0.5%  â†’ 96ç‚¹
èª¤å·® 1.0%  â†’ 92ç‚¹
èª¤å·® 2.0%  â†’ 84ç‚¹
èª¤å·® 5.0%  â†’ 50ç‚¹ â† r0ã®åŸºæº–ç‚¹
èª¤å·® 10.0% â†’ 20ç‚¹
```

---

## ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ‰‹é †

### ã‚¹ãƒ†ãƒƒãƒ—1: ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«é©ç”¨

```bash
# Dockerã‚³ãƒ³ãƒ†ãƒŠå†…ã§å®Ÿè¡Œ
docker exec -it cot_game-db-1 psql -U postgres -d cot_game -f /docker-entrypoint-initdb.d/migrations/20250128_add_scoring_params.sql
```

### ã‚¹ãƒ†ãƒƒãƒ—2: æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã®ç¢ºèª

```sql
-- å…¨å•é¡ŒãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’æŒã¤ã“ã¨ã‚’ç¢ºèª
SELECT id, level, scoring_r0, scoring_p, scoring_tol_abs_hint
FROM questions;
```

### ã‚¹ãƒ†ãƒƒãƒ—3: ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®ãƒ‡ãƒ—ãƒ­ã‚¤

1. ãƒ¢ãƒ‡ãƒ«æ›´æ–°
2. Evaluatoræ‹¡å¼µ
3. ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ä¿®æ­£
4. ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ

### ã‚¹ãƒ†ãƒƒãƒ—4: å‹•ä½œç¢ºèª

```bash
# æ—¢å­˜ã®å•é¡Œã§ã‚¹ã‚³ã‚¢ãŒå¤‰ã‚ã‚‰ãªã„ã“ã¨ã‚’ç¢ºèª
curl http://localhost:8080/api/v1/questions

# solve APIã§æ­£ã—ããƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒä½¿ç”¨ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
```

---

## å¾Œæ–¹äº’æ›æ€§ã®ä¿è¨¼

### ä¿è¨¼äº‹é …

1. **æ—¢å­˜ã®å•é¡Œã¯å½±éŸ¿ã‚’å—ã‘ãªã„**
   - DEFAULTå€¤ã«ã‚ˆã‚Šè‡ªå‹•çš„ã«ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒè¨­å®šã•ã‚Œã‚‹
   - ã‚¹ã‚³ã‚¢è¨ˆç®—çµæœã¯å¤‰ã‚ã‚‰ãªã„

2. **æ—¢å­˜ã®APIã¯å¤‰æ›´ä¸è¦**
   - `Evaluate()` é–¢æ•°ã¯å¼•ãç¶šãå‹•ä½œ
   - å†…éƒ¨çš„ã« `EvaluateWithParams()` ã‚’å‘¼ã³å‡ºã™ã ã‘

3. **æ®µéšçš„ãªç§»è¡ŒãŒå¯èƒ½**
   - Phase 1-4ã¾ã§å®Ÿè£…ã™ã‚Œã°åŸºæœ¬æ©Ÿèƒ½ã¯å®Œæˆ
   - Phase 5-7ã¯å¿…è¦ã«å¿œã˜ã¦å¾Œã‹ã‚‰è¿½åŠ å¯èƒ½

---

## ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã¸ã®å½±éŸ¿

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹

- **ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸å¢—åŠ :** å•é¡Œ1ä»¶ã‚ãŸã‚Šç´„24ãƒã‚¤ãƒˆï¼ˆDOUBLE PRECISION Ã— 3ï¼‰
- **ã‚¯ã‚¨ãƒªæ€§èƒ½:** SELECTæ™‚ã«3ã‚«ãƒ©ãƒ è¿½åŠ ã ãŒã€ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãªã—ã§ã‚‚å½±éŸ¿ã¯å¾®å°

### è¨ˆç®—ã‚³ã‚¹ãƒˆ

- **è©•ä¾¡é–¢æ•°:** ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å¼•æ•°ã§å—ã‘å–ã‚‹ã ã‘ãªã®ã§å½±éŸ¿ãªã—
- **ãƒ¡ãƒ¢ãƒª:** æ§‹é€ ä½“ã‚µã‚¤ã‚ºãŒã‚ãšã‹ã«å¢—åŠ ï¼ˆç„¡è¦–ã§ãã‚‹ãƒ¬ãƒ™ãƒ«ï¼‰

---

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è€ƒæ…®äº‹é …

### å…¥åŠ›æ¤œè¨¼ï¼ˆç®¡ç†APIå®Ÿè£…æ™‚ï¼‰

```go
// ValidateScoringParams ã¯ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å¦¥å½“æ€§ã‚’æ¤œè¨¼ã—ã¾ã™
func ValidateScoringParams(params ScoringParams) error {
    if params.R0 <= 0 || params.R0 > 1.0 {
        return errors.New("r0ã¯0ã‚ˆã‚Šå¤§ãã1.0ä»¥ä¸‹ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™")
    }
    if params.P <= 0 || params.P > 10.0 {
        return errors.New("pã¯0ã‚ˆã‚Šå¤§ãã10.0ä»¥ä¸‹ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™")
    }
    if params.TolAbsHint <= 0 {
        return errors.New("tol_abs_hintã¯æ­£ã®å€¤ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™")
    }
    return nil
}
```

### æ¨©é™ç®¡ç†

- ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å¤‰æ›´ã¯**ç®¡ç†è€…ã®ã¿**ã«åˆ¶é™
- ä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯é–²è¦§ä¸å¯ï¼ˆAPIä»•æ§˜ã‹ã‚‰é™¤å¤–ï¼‰

---

## å®Ÿè£…å„ªå…ˆé †ä½

### å¿…é ˆï¼ˆMVPï¼‰

- âœ… Phase 1: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒæ‹¡å¼µ
- âœ… Phase 2: ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒ¢ãƒ‡ãƒ«æ›´æ–°
- âœ… Phase 3: Evaluatoræ‹¡å¼µ
- âœ… Phase 4: ãƒãƒ³ãƒ‰ãƒ©ãƒ¼å±¤æ›´æ–°
- âœ… Phase 5: ãƒ†ã‚¹ãƒˆæ›´æ–°

### æ¨å¥¨ï¼ˆæ¬¡æœŸãƒªãƒªãƒ¼ã‚¹ï¼‰

- â³ Phase 6: å•é¡Œç®¡ç†API
- â³ Phase 7: ç®¡ç†ç”»é¢UI

### ã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼ˆå°†æ¥çš„ãªæ‹¡å¼µï¼‰

- ğŸ“Š ã‚¹ã‚³ã‚¢åˆ†å¸ƒã®çµ±è¨ˆåˆ†æ
- ğŸ® é›£æ˜“åº¦è‡ªå‹•èª¿æ•´AI
- ğŸ“ˆ ãƒ¦ãƒ¼ã‚¶ãƒ¼ã”ã¨ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æœ€é©åŒ–

---

## ã¾ã¨ã‚

æœ¬ã‚¿ã‚¹ã‚¯ã«ã‚ˆã‚Šã€ä»¥ä¸‹ãŒå®Ÿç¾ã•ã‚Œã‚‹:

1. **æŸ”è»Ÿæ€§:** å•é¡Œã®æ€§è³ªã«å¿œã˜ãŸæœ€é©ãªã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°ãŒå¯èƒ½
2. **æ‹¡å¼µæ€§:** æ–°ã—ã„è©•ä¾¡ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã‚‚ç°¡å˜ã«è¿½åŠ ã§ãã‚‹è¨­è¨ˆ
3. **äº’æ›æ€§:** æ—¢å­˜ã‚·ã‚¹ãƒ†ãƒ ã¸ã®å½±éŸ¿ãªã—
4. **ä¿å®ˆæ€§:** ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ç®¡ç†ãŒä¸€å…ƒåŒ–ã•ã‚Œã€èª¿æ•´ãŒå®¹æ˜“

**å®Ÿè£…å·¥æ•°è¦‹ç©ã‚‚ã‚Š:**

- Phase 1-5ï¼ˆå¿…é ˆï¼‰: ç´„8-12æ™‚é–“
- Phase 6-7ï¼ˆæ¨å¥¨ï¼‰: ç´„16-24æ™‚é–“

**æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—:**
Phase 1ã®ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆã‹ã‚‰ç€æ‰‹ã™ã‚‹ã“ã¨ã‚’æ¨å¥¨ã€‚
