# 6. Solveエンドポイント実装

## 目的 / 背景

- `docs/plan_0907.md` Sprint1 主要成果: `POST /api/v1/solve` の提供。
- ユーザーのプロンプトをAIに転送し評価結果を返却する中核API。

## 完了条件

- ルート: `POST /api/v1/solve` が 200 成功応答。
- 入力 JSON: `{question_id, prompt, model}` バリデーション（必須, 長さ制限, prompt文字数 >0 && <= 2000等）。
- 出力 JSON: 仕様( plan_0907.md 「API仕様」セクション )に一致。
- DB `scores` に1レコード保存 (拡張カラム適用後)。
- AI呼出エラー時: 冪等で 502/504 / メッセージ統一 (後続「統一エラーレスポンス整備」で再利用)。
- ハンドラ結合テスト(モックAI)が成功。

## スコープ

- 含む: ハンドラ, ルーティング, 入力検証, 評価呼出, 保存, レスポンス生成。
- 含まない: レートリミット（別タスク）, ログ詳細整備（別タスク）。

## 作業手順

- [x] `handlers/solve_handler.go` 作成
- [x] Request DTO / Response DTO 定義
- [x] 入力検証 (question存在確認, prompt長)
- [x] AIクライアント呼出 + レイテンシ計測
- [x] 評価ロジック呼出 (score, 抽出値, 評価種別)
- [x] scores 保存 (リポジトリ層利用)
- [x] JSON 応答生成
- [x] ルート登録 `routes/solve_routes.go`
- [x] 結合テスト (Gemini)

## 依存関係 / リスク

- 依存: AI連携クライアント実装, 評価ロジック実装, scores拡張マイグレーション完了
- リスク: 同期処理のレイテンシ増大 → タイムアウト設定 / 並列許容設計

## 見積り / 担当 / 期日

- 見積り: 1.5人日
- 担当: 未定
- 期日: Sprint1 (2025-09-14)

## 参考リンク

- `../plan_0907.md`
- `../app.md`
