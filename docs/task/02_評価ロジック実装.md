# 2. 評価ロジック実装

## 目的 / 背景

- `docs/plan_0907.md` Sprint1: 数値抽出 + 許容誤差評価。
- `docs/app.md` スコアリング例に基づき点数決定ロジックを提供。

## 完了条件

- `internal/eval/evaluator.go` 作成。
- エクスポート関数: `Evaluate(answerText string, correct string) (score int, extracted *float64, mode string, detail map[string]any)`
- スコアロジック: 誤差 `diff` に対して `score = 100 * exp(-k * diff)` （`k` は `diff=0.01` で 95 点となる値）を用いる連続スコア。`diff=0` は 100、差が大きくなるほど 0 に漸近。
- 正規表現で最初の数値(符号/小数対応)抽出。複数候補: 最初を採用。
- `detail` マップに以下を含む: 抽出したテキスト/数値、`numeric_diff`、`normalized_score`、差分精度情報（高精度計算時は `diff_precision=rational`）。
- 文字列ベースの誤差算出を行う `calculatePreciseDiff`（`math/big`）を実装し、可能な限り高精度に差分を計算。
- 単体テスト 10 ケース (境界: 完全一致, 0.009差, 0.011差, 非数値, 複数数値, 負数, 小数, 空文字, 前後空白, 誤差境界)。

## スコープ

- 含む: 数値抽出, 誤差判定, スコア算出, 詳細情報マップ。
- 含まない: 相対誤差, 多値比較高度化。

## 作業手順

- [x] ディレクトリ `backend/internal/eval/`
- [x] evaluator 実装
- [x] 正規表現ユーティリティ
- [x] テストファイル `evaluator_test.go`
- [x] コメント/README補足

## 依存関係 / リスク

- 依存: なし（AI出力形式を想定）
- リスク: ロケール(全角/カンマ区切り)非対応 → MVPでは非対応明示

## 見積り / 担当 / 期日

- 見積り: 1人日
- 担当: 未定
- 期日: Sprint1 (2025-09-12)

## 参考リンク

- `../plan_0907.md`
- `../app.md`
