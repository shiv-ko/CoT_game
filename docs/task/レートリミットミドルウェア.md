# レートリミットミドルウェア

## 目的 / 背景

- AI API コスト抑制 & 濫用防止 (`docs/app.md` セキュリティ考慮 / `plan_0907.md` Sprint3品質)。

## 完了条件

- グローバルミドルウェア: IP単位 N req / 分 (初期値 30など .env で設定)。
- 超過時: 429 JSON `{code:"rate_limit", message:"Too Many Requests"}`。
- テスト: 制限値+1回で 429 返却。
- 設定: 環境変数 `RATE_LIMIT_PER_MINUTE` で調整。

## スコープ

- 含む: インメモリカウンタ (sync.Map + time bucket)。
- 含まない: 分散レート制御 (Redis等)。

## 作業手順

- [ ] `middleware/rate_limit.go` 作成
- [ ] 設定読み込み
- [ ] カウンタ更新/リセットロジック
- [ ] 適用範囲: `/api/v1` グループ
- [ ] テスト (ループリクエスト)

## 依存関係 / リスク

- 依存: Solveエンドポイント実装 (適用対象)
- リスク: 高並列時競合 → sync.Map + atomic で緩和

## 見積り / 担当 / 期日

- 見積り: 0.5人日
- 担当: 未定
- 期日: Sprint3 (2025-09-23)

## 参考リンク

- `../app.md`
- `../plan_0907.md`
