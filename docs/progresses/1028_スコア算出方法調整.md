了解👌
以下は、**現行スコア算出方法の問題点と改善後の実装内容**を、技術ドキュメントとして整理した Markdown 版です。
そのまま `docs/scoring_v2.md` などに保存できます。

---

````markdown
# 🎯 スコア算出方式の改善設計書

## 概要

本アプリケーションは数学や論理パズルなど、**数値的な正確さを競う問題**を対象としている。  
既存のスコア算出式では、誤差の大きさや問題スケールに対する評価が適切でないケースがあり、  
公平性・直感性を損ねている。  
そこで、本ドキュメントでは **スコア算出方式（v2）** の改善内容をまとめる。

---

## 🧮 現行方式（v1）の概要

### 評価式

指数関数的減衰モデル：

```go
score = 100 * math.Exp(-k * diff)
```
````

- `diff` : 正解と回答の**絶対誤差**
- `k` : 減衰率（誤差 0.01 のとき 95点になるよう設定）

```go
k = -math.Log(0.95) / 0.01 ≈ 5.13
```

### スコア例

| 誤差(diff) | スコア |
| ---------- | ------ |
| 0.00       | 100    |
| 0.01       | 95     |
| 0.02       | 90     |
| 0.05       | 77     |
| 0.10       | 60     |
| 0.50       | 8      |
| 1.00       | 1      |

---

## ⚠️ 現行方式の問題点

| 問題                              | 詳細説明                                                          |
| --------------------------------- | ----------------------------------------------------------------- |
| **1. 小誤差でも急激に減点される** | 誤差 0.01 (1%) でも既に 5 点減点。初期減衰が急すぎる。            |
| **2. 大誤差でスコアが潰れる**     | 誤差 0.5 以上でスコアがほぼ 0。差がつかない。                     |
| **3. 問題スケール非依存**         | 正解 10 と 1000 で誤差 0.1 が同評価（相対的精度を反映できない）。 |

---

## 💡 改善方針（v2）

数学的精度をより公平に評価するため、以下の設計方針を採用する。

### 1. 相対誤差に基づくスコアリング

誤差を **正解値に対して相対的** に評価：

```
rel = |y_pred - y_true| / max(|y_true|, tolAbsHint)
```

- `tolAbsHint`: 正解が 0 の場合のスケール補助（例：1e-2）

### 2. ロジスティック関数で減衰を制御

指数関数の代わりに **ロジスティック関数** を用いる：

```
score = 100 / (1 + (rel / r0)^p)
```

| パラメータ | 意味                         | デフォルト |
| ---------- | ---------------------------- | ---------- |
| `r0`       | スコアが 50 点になる相対誤差 | 0.05 (5%)  |
| `p`        | 曲率（減衰の急さ）           | 2.0        |

### 📊 挙動例（r0=5%, p=2）

| 相対誤差 | スコア |
| -------: | -----: |
|       0% |    100 |
|     0.5% |     99 |
|       1% |     97 |
|       2% |     92 |
|       5% |     50 |
|      10% |     20 |
|      20% |      5 |

---

## ✅ 改善効果まとめ

| 観点                   | 改善内容                                        |
| ---------------------- | ----------------------------------------------- |
| **スケール適応性**     | 問題の値の大小に関係なく、公平な評価が可能。    |
| **スムーズな減点**     | 小誤差では満点近く、大誤差では段階的に減少。    |
| **パラメータの直感性** | “5%誤差で50点” のように意味のある設計ができる。 |
| **大誤差での差別化**   | スコアが0に張り付かず、差を維持。               |
